---


---

<h1 id="luogup1305题解">LuoguP1305题解</h1>
<blockquote>
<p>简单的Splay操作题</p>
</blockquote>
<!--more-->
<h3 id="description">Description</h3>
<p>描述 县城里有n个用地道相连的房子，第i个只与第i-1和第i+1个相连。这是有m个消息依次传来</p>
<p>1、消息为D x：鬼子将x号房子摧毁了，地道被堵上。</p>
<p>2、消息为R ：村民们将鬼子上一个摧毁的房子修复了。</p>
<p>3、消息为Q x：有一名士兵被围堵在x号房子中。</p>
<p>李云龙收到信息很紧张，他想知道每一个被围堵的士兵能够到达的房子有几个。</p>
<h3 id="samples">Samples</h3>
<h4 id="input-1">Input #1</h4>
<pre class=" language-markdown"><code class="prism  language-markdown">7 9
D 3
D 6
D 5
Q 4
Q 5
R
Q 4
R
Q 4
</code></pre>
<h4 id="output-1">Output #1</h4>
<pre class=" language-markdown"><code class="prism  language-markdown">1
0
2
4
</code></pre>
<h3 id="solution">Solution</h3>
<p>Splay裸题.</p>
<p>首先对于摧毁操作<code>D x</code>, 我们把一个<code>val = x</code>的节点插入<code>Splay</code>.</p>
<p>这样可以让<code>Q x</code>操作转化为查询<code>x</code>的后继 - <code>x</code>的前趋 + 1.</p>
<p><code>R</code>操作就直接用一个栈维护插入的数, 然后把栈顶<code>Remove</code>掉就完了.</p>
<h3 id="code">Code</h3>
<pre class=" language-c"><code class="prism ++ language-c"><span class="token comment">/* Headers */</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;climits&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;cstdio&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;cctype&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;cmath&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;queue&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stack&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;map&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> FOR(i,a,b,c) for(int i=(a);i&lt;=(b);i+=(c))</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ROF(i,a,b,c) for(int i=(a);i&gt;=(b);i-=(c))</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FORL(i,a,b,c) for(long long i=(a);i&lt;=(b);i+=(c))</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ROFL(i,a,b,c) for(long long i=(a);i&gt;=(b);i-=(c))</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FORR(i,a,b,c) for(register int i=(a);i&lt;=(b);i+=(c))</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ROFR(i,a,b,c) for(register int i=(a);i&gt;=(b);i-=(c))</span>
<span class="token macro property">#<span class="token directive keyword">define</span> lowbit(x) x&amp;(-x)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> LeftChild(x) x&lt;&lt;1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> RightChild(x) (x&lt;&lt;1)+1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> RevEdge(x) x^1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FILE_IN(x) freopen(x,"r",stdin);</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FILE_OUT(x) freopen(x,"w",stdout);</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CLOSE_IN() fclose(stdin);</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CLOSE_OUT() fclose(stdout);</span>
<span class="token macro property">#<span class="token directive keyword">define</span> IOS(x) std::ios::sync_with_stdio(x)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> Dividing() printf("-----------------------------------\n");</span>
namespace FastIO<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">int</span> BUFSIZE <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> ibuf<span class="token punctuation">[</span>BUFSIZE<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">*</span>is <span class="token operator">=</span> ibuf<span class="token punctuation">,</span><span class="token operator">*</span>its <span class="token operator">=</span> ibuf<span class="token punctuation">;</span>
    <span class="token keyword">char</span> obuf<span class="token punctuation">[</span>BUFSIZE<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">*</span>os <span class="token operator">=</span> obuf<span class="token punctuation">,</span><span class="token operator">*</span>ot <span class="token operator">=</span> obuf <span class="token operator">+</span> BUFSIZE<span class="token punctuation">;</span>
    <span class="token keyword">inline</span> <span class="token keyword">char</span> <span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>is <span class="token operator">==</span> its<span class="token punctuation">)</span>
            its <span class="token operator">=</span> <span class="token punctuation">(</span>is <span class="token operator">=</span> ibuf<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">fread</span><span class="token punctuation">(</span>ibuf<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>BUFSIZE<span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>is <span class="token operator">==</span> its<span class="token punctuation">)</span><span class="token operator">?</span><span class="token constant">EOF</span><span class="token punctuation">:</span><span class="token operator">*</span>is<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">getint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>neg <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>ch <span class="token operator">=</span> <span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token operator">||</span> ch <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> ch <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span>
            ch <span class="token operator">=</span> <span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            neg <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            res <span class="token operator">=</span> <span class="token punctuation">(</span>res <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>res <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token punctuation">(</span>ch <span class="token operator">-</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ch <span class="token operator">=</span> <span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> neg<span class="token operator">?</span><span class="token operator">-</span>res<span class="token punctuation">:</span>res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fwrite</span><span class="token punctuation">(</span>obuf<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>os <span class="token operator">-</span> obuf<span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        os <span class="token operator">=</span> obuf<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">putch</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">*</span>os<span class="token operator">++</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>os <span class="token operator">==</span> ot<span class="token punctuation">)</span>	<span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">putint</span><span class="token punctuation">(</span><span class="token keyword">int</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">char</span> q<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">putch</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">putch</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>res <span class="token operator">=</span> <span class="token operator">-</span>res<span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token keyword">int</span> top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>
            q<span class="token punctuation">[</span>top<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> res <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
            res <span class="token operator">/</span><span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>top<span class="token operator">--</span><span class="token punctuation">)</span>	<span class="token function">putch</span><span class="token punctuation">(</span>q<span class="token punctuation">[</span>top<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">space</span><span class="token punctuation">(</span>bool x<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>x<span class="token punctuation">)</span> <span class="token function">putch</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">else</span> <span class="token function">putch</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> rt <span class="token operator">=</span> FastIO<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    x <span class="token operator">=</span> rt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span>bool enter<span class="token punctuation">)</span><span class="token punctuation">{</span>
    FastIO<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">putint</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    FastIO<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FastIO<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">space</span><span class="token punctuation">(</span>enter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* definitions */</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> MAXN <span class="token operator">=</span> <span class="token number">5e4</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> Tree<span class="token punctuation">{</span>
	<span class="token keyword">int</span> ch<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> cnt<span class="token punctuation">,</span> val<span class="token punctuation">,</span> fa<span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">define</span> Lef(x, k) Splay[Splay[x].ch[0]].k</span>
	<span class="token macro property">#<span class="token directive keyword">define</span> Rig(x, k) Splay[Splay[x].ch[1]].k</span>
<span class="token punctuation">}</span>Splay<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> root<span class="token punctuation">,</span> Node<span class="token punctuation">;</span>
std<span class="token punctuation">:</span><span class="token punctuation">:</span>stack<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> room<span class="token punctuation">;</span>
<span class="token comment">/* functions */</span>
<span class="token keyword">inline</span> bool <span class="token function">FIND</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>Splay<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>fa<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">pushUp</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Splay<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token function">Lef</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> size<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">Rig</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> size<span class="token punctuation">)</span> <span class="token operator">+</span> Splay<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>cnt<span class="token punctuation">;</span>	
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">Rotate</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> fx <span class="token operator">=</span> Splay<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>fa<span class="token punctuation">,</span> fy <span class="token operator">=</span> Splay<span class="token punctuation">[</span>fx<span class="token punctuation">]</span><span class="token punctuation">.</span>fa<span class="token punctuation">;</span>
	<span class="token keyword">int</span> chx <span class="token operator">=</span> <span class="token function">FIND</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> chy <span class="token operator">=</span> Splay<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span>chx <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	Splay<span class="token punctuation">[</span>fx<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span>chx<span class="token punctuation">]</span> <span class="token operator">=</span> chy<span class="token punctuation">;</span> Splay<span class="token punctuation">[</span>chy<span class="token punctuation">]</span><span class="token punctuation">.</span>fa <span class="token operator">=</span> fx<span class="token punctuation">;</span>
	Splay<span class="token punctuation">[</span>fy<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token function">FIND</span><span class="token punctuation">(</span>fx<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span> Splay<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>fa <span class="token operator">=</span> fy<span class="token punctuation">;</span>
	Splay<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span>chx <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> fx<span class="token punctuation">;</span> Splay<span class="token punctuation">[</span>fx<span class="token punctuation">]</span><span class="token punctuation">.</span>fa <span class="token operator">=</span> x<span class="token punctuation">;</span>
	<span class="token function">pushUp</span><span class="token punctuation">(</span>fx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">pushUp</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">splay</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> rt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>fa <span class="token operator">!=</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> fx <span class="token operator">=</span> Splay<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>fa<span class="token punctuation">,</span> fy <span class="token operator">=</span> Splay<span class="token punctuation">[</span>fx<span class="token punctuation">]</span><span class="token punctuation">.</span>fa<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>fy <span class="token operator">!=</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FIND</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">FIND</span><span class="token punctuation">(</span>fx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">Rotate</span><span class="token punctuation">(</span>fx<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token function">Rotate</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">Rotate</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rt<span class="token punctuation">)</span> root <span class="token operator">=</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> rt <span class="token operator">=</span> root<span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>rt <span class="token operator">&amp;&amp;</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>val <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		p <span class="token operator">=</span> rt<span class="token punctuation">;</span>
		rt <span class="token operator">=</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span>x <span class="token operator">&gt;</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>val<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>cnt<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		rt <span class="token operator">=</span> <span class="token operator">++</span>Node<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> Splay<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span>x <span class="token operator">&gt;</span> Splay<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>val<span class="token punctuation">]</span> <span class="token operator">=</span> rt<span class="token punctuation">;</span>
		Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>fa <span class="token operator">=</span> p<span class="token punctuation">;</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>val <span class="token operator">=</span> x<span class="token punctuation">;</span>
		Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>cnt <span class="token operator">=</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>cnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">splay</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">LowerX</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> rt <span class="token operator">=</span> root<span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span>x <span class="token operator">&gt;</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>val<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!=</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>val<span class="token punctuation">)</span>
		rt <span class="token operator">=</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span>x <span class="token operator">&gt;</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>val<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">splay</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">Querypre</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">LowerX</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">.</span>val <span class="token operator">&lt;</span> x<span class="token punctuation">)</span> <span class="token keyword">return</span> root<span class="token punctuation">;</span>
	<span class="token keyword">int</span> rt <span class="token operator">=</span> Splay<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> rt <span class="token operator">=</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> rt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">Querysuf</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">LowerX</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">.</span>val <span class="token operator">&gt;</span> x<span class="token punctuation">)</span> <span class="token keyword">return</span> root<span class="token punctuation">;</span>
	<span class="token keyword">int</span> rt <span class="token operator">=</span> Splay<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> rt <span class="token operator">=</span> Splay<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> rt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">Remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> last <span class="token operator">=</span> <span class="token function">Querypre</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> next <span class="token operator">=</span> <span class="token function">Querysuf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">splay</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">splay</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> del <span class="token operator">=</span> Splay<span class="token punctuation">[</span>next<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>del<span class="token punctuation">]</span><span class="token punctuation">.</span>cnt <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>Splay<span class="token punctuation">[</span>del<span class="token punctuation">]</span><span class="token punctuation">.</span>cnt<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token function">splay</span><span class="token punctuation">(</span>del<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">else</span> Splay<span class="token punctuation">[</span>next<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d %d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Insert</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">FOR</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">char</span> opt<span class="token punctuation">;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>cin<span class="token operator">&gt;&gt;</span>opt<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>opt <span class="token operator">==</span> <span class="token string">'D'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">int</span> x<span class="token punctuation">;</span> <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Insert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> room<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>opt <span class="token operator">==</span> <span class="token string">'R'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">Remove</span><span class="token punctuation">(</span>room<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
			room<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>opt <span class="token operator">==</span> <span class="token string">'Q'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">int</span> x<span class="token punctuation">;</span> <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LowerX</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Splay<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">.</span>val <span class="token operator">==</span> x<span class="token punctuation">)</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token keyword">int</span> last <span class="token operator">=</span> <span class="token function">Querypre</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> next <span class="token operator">=</span> <span class="token function">Querysuf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> ans <span class="token operator">=</span> Splay<span class="token punctuation">[</span>next<span class="token punctuation">]</span><span class="token punctuation">.</span>val <span class="token operator">-</span> Splay<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">.</span>val <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="the-end">THE END</h1>

